<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SmartHR - User Management</title>
  <link href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@300;400;500;700&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <style>
    :root {
      --randwater-primary: #0066CC;
      --randwater-secondary: #00A3E0;
      --randwater-accent: #FF6600;
      --randwater-dark: #003366;
      --randwater-light: #E6F3FF;
    }
    
    body {
      font-family: 'Ubuntu', sans-serif;
      background-color: #f8f9fa;
      font-size: 0.9rem;
      margin: 0;
      padding: 0;
    }
    
    .page-header {
      background: linear-gradient(135deg, var(--randwater-primary) 0%, var(--randwater-secondary) 100%);
      color: white;
      padding: 2rem 0;
      margin-bottom: 2rem;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
    
    .page-title {
      margin: 0;
      font-weight: 700;
      text-shadow: 0 2px 4px rgba(0,0,0,0.3);
      font-size: 2.2rem;
    }
    
    .branding {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 8px;
      margin-right: 1rem;
    }
    
    .gosmarthr-logo {
      max-height: 100px;
      margin-top: 8px;
    }
    
    .main-section {
      background: white;
      border-radius: 12px;
      padding: 2rem;
      margin-bottom: 2rem;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    
    .section-header {
      color: var(--randwater-dark);
      margin-bottom: 1.5rem;
      border-bottom: 2px solid var(--randwater-light);
      padding-bottom: 0.5rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .btn-back {
      background: #6c757d;
      color: white;
      border: none;
      padding: 0.75rem 1.5rem;
      border-radius: 8px;
      font-weight: 600;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      transition: all 0.3s ease;
    }
    
    .btn-back:hover {
      background: #5a6268;
      color: white;
      text-decoration: none;
      transform: translateY(-2px);
    }
    
    .btn-add {
      background: var(--randwater-accent);
      color: white;
      border: none;
      padding: 0.75rem 1.5rem;
      border-radius: 8px;
      font-weight: 600;
      transition: all 0.3s ease;
    }
    
    .btn-add:hover {
      background: #ff8533;
      transform: translateY(-2px);
    }
    
    .btn-edit {
      background: var(--randwater-primary);
      color: white;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 6px;
      font-size: 0.85rem;
      transition: all 0.3s ease;
    }
    
    .btn-edit:hover {
      background: var(--randwater-secondary);
      transform: translateY(-2px);
    }
    
    .btn-delete {
      background: #dc3545;
      color: white;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 6px;
      font-size: 0.85rem;
      transition: all 0.3s ease;
    }
    
    .btn-delete:hover {
      background: #c82333;
      transform: translateY(-2px);
    }
    
    .btn-reset {
      background: #ffc107;
      color: #212529;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 6px;
      font-size: 0.85rem;
      transition: all 0.3s ease;
    }
    
    .btn-reset:hover {
      background: #e0a800;
      transform: translateY(-2px);
    }
    
    .table-responsive {
      border-radius: 8px;
      overflow: hidden;
    }
    
    .table th {
      background-color: var(--randwater-light);
      border-color: var(--randwater-secondary);
      color: var(--randwater-dark);
      font-weight: 600;
      padding: 1rem;
    }
    
    .table td {
      padding: 1rem;
      vertical-align: middle;
    }
    
    .table tbody tr:hover {
      background-color: #f8f9fa;
    }
    
    .status-badge {
      padding: 0.25rem 0.75rem;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 600;
    }
    
    .status-active {
      background-color: #d4edda;
      color: #155724;
    }
    
    .status-inactive {
      background-color: #f8d7da;
      color: #721c24;
    }
    
    .status-pending {
      background-color: #fff3cd;
      color: #856404;
    }
    
    .role-badge {
      padding: 0.25rem 0.75rem;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 600;
    }
    
    .role-admin {
      background-color: #cce5ff;
      color: #004085;
    }
    
    .role-super {
      background-color: #d1ecf1;
      color: #0c5460;
    }
    
    .table-actions {
      display: flex;
      gap: 0.5rem;
      justify-content: center;
      flex-wrap: wrap;
    }
    
    .user-stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
      margin-bottom: 2rem;
    }
    
    .stat-card {
      background: var(--randwater-light);
      border: 2px solid var(--randwater-secondary);
      border-radius: 8px;
      padding: 1.5rem;
      text-align: center;
    }
    
    .stat-card .number {
      font-size: 2rem;
      font-weight: 700;
      color: var(--randwater-accent);
      display: block;
    }
    
    .stat-card .label {
      color: var(--randwater-dark);
      font-size: 0.9rem;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      font-weight: 600;
    }
    
    .permission-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1rem;
      margin-top: 1rem;
    }
    
    .permission-item {
      background: #f8f9fa;
      border: 1px solid #dee2e6;
      border-radius: 6px;
      padding: 1rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .permission-item input[type="checkbox"] {
      transform: scale(1.2);
    }
    
    .permission-item label {
      margin: 0;
      font-weight: 500;
      color: var(--randwater-dark);
    }
    
    .last-login {
      font-size: 0.85rem;
      color: #6c757d;
    }
    
    .filters {
      background: var(--randwater-light);
      border: 1px solid var(--randwater-secondary);
      border-radius: 8px;
      padding: 1rem;
      margin-bottom: 1.5rem;
    }
    
    .filters h6 {
      color: var(--randwater-dark);
      margin-bottom: 1rem;
    }
    
    .filter-row {
      display: flex;
      gap: 1rem;
      align-items: end;
      flex-wrap: wrap;
    }
    
    .filter-group {
      flex: 1;
      min-width: 200px;
    }
    
    .filter-group label {
      font-size: 0.8rem;
      color: var(--randwater-dark);
      margin-bottom: 0.25rem;
    }
  </style>
</head>
<body>
  <div class="page-header">
    <div class="container">
      <div class="row align-items-center">
        <div class="col-md-8">
          <h1 class="page-title">
            <i class="fas fa-users-cog"></i>
            User Management
          </h1>
          <p class="text-light mb-0">
            Manage Randwater admin users, permissions, and access control
          </p>
        </div>
        <div class="col-md-4 text-end">
          <div class="branding">
            <img src="/static/images/smarthr_logo_white.png" alt="SmartHR Logo" class="gosmarthr-logo">
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="container">
    <!-- Navigation -->
    <div class="mb-4">
      <a href="{{ url_for('super_admin_dashboard') }}" class="btn-back">
        <i class="fas fa-arrow-left"></i> Back to Super Admin Dashboard
      </a>
    </div>

    <!-- User Statistics -->
    <div class="main-section">
      <h5 class="section-header">
        <i class="fas fa-chart-bar"></i> User Overview
      </h5>
      <div class="user-stats">
        <div class="stat-card">
          <span class="number">{{ admin_users|length }}</span>
          <span class="label">Total Users</span>
        </div>
        <div class="stat-card">
          <span class="number">{{ admin_users|selectattr('status', 'equalto', 'Active')|list|length }}</span>
          <span class="label">Active Users</span>
        </div>
        <div class="stat-card">
          <span class="number">{{ admin_users|selectattr('status', 'equalto', 'Inactive')|list|length }}</span>
          <span class="label">Inactive Users</span>
        </div>
        <div class="stat-card">
          <span class="number">{{ admin_users|selectattr('last_login')|list|length }}</span>
          <span class="label">Users with Login History</span>
        </div>
      </div>
    </div>

    <!-- Filters -->
    <div class="main-section">
      <h5 class="section-header">
        <i class="fas fa-filter"></i> Filter Options
      </h5>
      <div class="filters">
        <div class="filter-row">
          <div class="filter-group">
            <label>User Status</label>
            <select class="form-select" id="statusFilter">
              <option value="">All Statuses</option>
              <option value="Active">Active</option>
              <option value="Inactive">Inactive</option>
              <option value="Pending">Pending</option>
            </select>
          </div>
          <div class="filter-group">
            <label>Role Type</label>
            <select class="form-select" id="roleFilter">
              <option value="">All Roles</option>
              <option value="admin">Admin</option>
              <option value="super">Super Admin</option>
            </select>
          </div>
          <div class="filter-group">
            <label>Last Login</label>
            <select class="form-select" id="loginFilter">
              <option value="">All Time</option>
              <option value="today">Today</option>
              <option value="week">This Week</option>
              <option value="month">This Month</option>
              <option value="never">Never</option>
            </select>
          </div>
          <div class="filter-group">
            <button class="btn btn-primary" onclick="applyFilters()">
              <i class="fas fa-search"></i> Apply Filters
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- User Management Table -->
    <div class="main-section">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h5 class="section-header mb-0">
          <i class="fas fa-users"></i> Admin Users
        </h5>
        <button class="btn btn-add" onclick="addNewUser()">
          <i class="fas fa-user-plus"></i> Add New User
        </button>
      </div>
      
      <div class="table-responsive">
        <table class="table table-hover" id="userTable">
          <thead>
            <tr>
              <th>User ID</th>
              <th>Username</th>
              <th>Full Name</th>
              <th>Role</th>
              <th>Status</th>
              <th>Last Login</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for user in admin_users %}
            <tr data-status="{{ user.status }}" data-role="{{ user.role if user.role else 'admin' }}" data-login="{{ user.last_login }}">
              <td>{{ user.id }}</td>
              <td><strong>{{ user.username }}</strong></td>
              <td>{{ user.name }}</td>
              <td>
                {% if user.username == 'SuperAdmin' %}
                  <span class="role-badge role-super">Super Admin</span>
                {% else %}
                  <span class="role-badge role-admin">Admin</span>
                {% endif %}
              </td>
              <td>
                {% if user.status == 'Active' %}
                  <span class="status-badge status-active">{{ user.status }}</span>
                {% elif user.status == 'Inactive' %}
                  <span class="status-badge status-inactive">{{ user.status }}</span>
                {% else %}
                  <span class="status-badge status-pending">{{ user.status }}</span>
                {% endif %}
              </td>
              <td>
                {% if user.last_login %}
                  <span class="last-login">{{ user.last_login }}</span>
                {% else %}
                  <span class="text-muted">Never</span>
                {% endif %}
              </td>
              <td>
                <div class="table-actions">
                  <button class="btn btn-edit btn-sm" onclick="editUser({{ user.id }})">
                    <i class="fas fa-edit"></i> Edit
                  </button>
                  {% if user.username != 'SuperAdmin' %}
                    <button class="btn btn-reset btn-sm" onclick="resetPassword({{ user.id }})">
                      <i class="fas fa-key"></i> Reset
                    </button>
                    <button class="btn btn-delete btn-sm" onclick="deleteUser({{ user.id }})">
                      <i class="fas fa-trash"></i> Delete
                    </button>
                  {% endif %}
                </div>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>

    <!-- User Permissions -->
    <div class="main-section">
      <h5 class="section-header">
        <i class="fas fa-shield-alt"></i> Permission Management
      </h5>
      <div class="row">
        <div class="col-md-6">
          <div class="card">
            <div class="card-header bg-primary text-white">
              <h6 class="mb-0"><i class="fas fa-user-shield"></i> Admin Permissions</h6>
            </div>
            <div class="card-body">
              <div class="permission-grid">
                <div class="permission-item">
                  <input type="checkbox" id="perm_upload" checked disabled>
                  <label for="perm_upload">Upload SAP Data</label>
                </div>
                <div class="permission-item">
                  <input type="checkbox" id="perm_manage_access" checked disabled>
                  <label for="perm_manage_access">Manage Employee Access</label>
                </div>
                <div class="permission-item">
                  <input type="checkbox" id="perm_salary_sim" checked disabled>
                  <label for="perm_salary_sim">Salary Simulator</label>
                </div>
                <div class="permission-item">
                  <input type="checkbox" id="perm_export" checked disabled>
                  <label for="perm_export">Export Packages</label>
                </div>
                <div class="permission-item">
                  <input type="checkbox" id="perm_view_reports" checked disabled>
                  <label for="perm_view_reports">View Reports</label>
                </div>
                <div class="permission-item">
                  <input type="checkbox" id="perm_manage_users" disabled>
                  <label for="perm_manage_users">Manage Users</label>
                </div>
              </div>
              <small class="text-muted">Admin users have access to core Randwater functions</small>
            </div>
          </div>
        </div>
        <div class="col-md-6">
          <div class="card">
            <div class="card-header bg-success text-white">
              <h6 class="mb-0"><i class="fas fa-crown"></i> Super Admin Permissions</h6>
            </div>
            <div class="card-body">
              <div class="permission-grid">
                <div class="permission-item">
                  <input type="checkbox" id="perm_super_all" checked disabled>
                  <label for="perm_super_all">All Admin Permissions</label>
                </div>
                <div class="permission-item">
                  <input type="checkbox" id="perm_manage_users" checked disabled>
                  <label for="perm_manage_users">Manage Users</label>
                </div>
                <div class="permission-item">
                  <input type="checkbox" id="perm_calculation_tables" checked disabled>
                  <label for="perm_calculation_tables">Calculation Tables</label>
                </div>
                <div class="permission-item">
                  <input type="checkbox" id="perm_security_settings" checked disabled>
                  <label for="perm_security_settings">Security Settings</label>
                </div>
                <div class="permission-item">
                  <input type="checkbox" id="perm_system_config" checked disabled>
                  <label for="perm_system_config">System Configuration</label>
                </div>
                <div class="permission-item">
                  <input type="checkbox" id="perm_audit_logs" checked disabled>
                  <label for="perm_audit_logs">Audit Logs</label>
                </div>
              </div>
              <small class="text-muted">Super Admin has access to all system functions</small>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- User Activity Log -->
    <div class="main-section">
      <h5 class="section-header">
        <i class="fas fa-history"></i> Recent User Activity
      </h5>
      <div class="table-responsive">
        <table class="table table-hover">
          <thead>
            <tr>
              <th>Timestamp</th>
              <th>User</th>
              <th>Action</th>
              <th>Details</th>
              <th>IP Address</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>2024-08-19 14:30:25</td>
              <td><strong>RandWaterAdmin</strong></td>
              <td>Login</td>
              <td>Successful login from office network</td>
              <td>192.168.1.100</td>
            </tr>
            <tr>
              <td>2024-08-19 14:25:10</td>
              <td><strong>RandWaterAdmin2</strong></td>
              <td>Upload SAP Data</td>
              <td>Uploaded employee package data (45 records)</td>
              <td>192.168.1.101</td>
            </tr>
            <tr>
              <td>2024-08-19 14:20:15</td>
              <td><strong>SuperAdmin</strong></td>
              <td>System Configuration</td>
              <td>Updated medical aid rates</td>
              <td>192.168.1.1</td>
            </tr>
            <tr>
              <td>2024-08-19 14:15:30</td>
              <td><strong>RandWaterAdmin3</strong></td>
              <td>Export Packages</td>
              <td>Exported 12 completed packages</td>
              <td>192.168.1.102</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <script>
    // Apply filters to user table
    function applyFilters() {
      const statusFilter = document.getElementById('statusFilter').value;
      const roleFilter = document.getElementById('roleFilter').value;
      const loginFilter = document.getElementById('loginFilter').value;
      
      const rows = document.querySelectorAll('#userTable tbody tr');
      
      rows.forEach(row => {
        let show = true;
        
        if (statusFilter && row.dataset.status !== statusFilter) {
          show = false;
        }
        
        if (roleFilter && row.dataset.role !== roleFilter) {
          show = false;
        }
        
        // Simple login filter logic
        if (loginFilter === 'never' && row.dataset.login) {
          show = false;
        } else if (loginFilter === 'today' && !row.dataset.login.includes('2024-08-19')) {
          show = false;
        }
        
        row.style.display = show ? '' : 'none';
      });
    }
    
    // Add new user
    function addNewUser() {
      alert('Add New User - This would open a user creation modal in production');
    }
    
    // Edit user
    function editUser(userId) {
      alert('Edit User ' + userId + ' - This would open an edit modal in production');
    }
    
    // Reset password
    function resetPassword(userId) {
      if (confirm('Are you sure you want to reset the password for user ' + userId + '?')) {
        alert('Password reset email sent to user ' + userId);
      }
    }
    
    // Delete user
    function deleteUser(userId) {
      if (confirm('Are you sure you want to delete user ' + userId + '? This action cannot be undone.')) {
        alert('User ' + userId + ' deleted successfully');
      }
    }
    
    // Initialize page
    document.addEventListener('DOMContentLoaded', function() {
      console.log('User Management loaded');
      applyFilters(); // Apply initial filters
    });
  </script>
</body>
</html>
