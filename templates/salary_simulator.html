<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Rand Water - Salary Simulator</title>
  <link href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@300;400;500;700&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <style>
    :root {
      --randwater-primary: #0066CC;
      --randwater-secondary: #00A3E0;
      --randwater-accent: #FF6600;
      --randwater-dark: #003366;
      --randwater-light: #E6F3FF;
    }
    
    body {
      font-family: 'Ubuntu', sans-serif;
      background-color: #f8f9fa;
      font-size: 0.9rem;
      margin: 0;
      padding: 0;
    }
    
    .randwater-header {
      background: linear-gradient(135deg, var(--randwater-primary) 0%, var(--randwater-secondary) 100%);
      color: white;
      padding: 1.5rem 0;
      margin-bottom: 1.5rem;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
    
    .randwater-header h1 {
      margin: 0;
      font-weight: 700;
      text-shadow: 0 2px 4px rgba(0,0,0,0.3);
      font-size: 1.8rem;
    }
    
    .randwater-header .tagline {
      font-size: 1rem;
      opacity: 0.9;
      margin-top: 0.5rem;
    }
    
         .randwater-logo {
       max-height: 80px;
       filter: brightness(0) invert(1);
     }
     
     .gosmarthr-logo {
       max-height: 100px;
       margin-top: 8px;
     }
     
     .branding {
       display: flex;
       flex-direction: column;
       align-items: flex-end;
       gap: 8px;
       margin-right: 1rem;
     }
     
                       .powered-by {
         font-size: 0.7rem;
         opacity: 0.9;
         text-transform: uppercase;
         letter-spacing: 1px;
         font-weight: 600;
         color: var(--randwater-accent);
       }
    
    .simulator-container {
      background: white;
      border-radius: 12px;
      padding: 2rem;
      margin-bottom: 1.5rem;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    
    .simulator-header {
      background: linear-gradient(135deg, var(--randwater-primary) 0%, var(--randwater-secondary) 100%);
      color: white;
      padding: 1rem 1.5rem;
      margin: -2rem -2rem 2rem -2rem;
      border-radius: 12px 12px 0 0;
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 1.2rem;
      font-weight: bold;
    }
    
    .form-section {
      background: var(--randwater-light);
      border: 1px solid var(--randwater-secondary);
      border-radius: 8px;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
    }
    
         .form-section h5 {
       color: var(--randwater-accent);
       margin-bottom: 1rem;
       border-bottom: 2px solid var(--randwater-secondary);
       padding-bottom: 0.5rem;
     }
    
    .form-control:focus {
      border-color: var(--randwater-primary);
      box-shadow: 0 0 0 0.2rem rgba(0, 102, 204, 0.25);
    }
    
    .btn-primary {
      background: linear-gradient(135deg, var(--randwater-primary) 0%, var(--randwater-secondary) 100%);
      border: none;
      border-radius: 8px;
      padding: 0.75rem 2rem;
      font-weight: 600;
    }
    
    .btn-secondary {
      background: #6c757d;
      border: none;
      border-radius: 8px;
      padding: 0.75rem 2rem;
      font-weight: 600;
    }
    
    .warning-badge {
      background: #fff3cd;
      color: #856404;
      border: 1px solid #ffeaa7;
      border-radius: 4px;
      padding: 0.25rem 0.5rem;
      font-size: 0.8rem;
      margin-top: 0.25rem;
    }
    
    .result-container {
      background: #f8f9fa;
      border: 1px solid #dee2e6;
      border-radius: 8px;
      padding: 1.5rem;
      margin-top: 1.5rem;
    }
    
    .result-item {
      display: flex;
      justify-content: space-between;
      padding: 0.5rem 0;
      border-bottom: 1px solid #dee2e6;
    }
    
    .result-item:last-child {
      border-bottom: none;
    }
    
    .result-item .label {
      font-weight: 600;
      color: var(--randwater-dark);
    }
    
         .result-item .value {
       font-weight: 700;
       color: var(--randwater-accent);
     }
    
    .result-item.total {
      background: var(--randwater-light);
      padding: 1rem;
      border-radius: 6px;
      margin-top: 1rem;
      border: 2px solid var(--randwater-primary);
    }
    
    .result-item.total .value {
      font-size: 1.2rem;
      color: var(--randwater-accent);
    }
    
    .medical-options {
      display: none;
    }
    
    .medical-options.show {
      display: block;
    }
    
    .dependants-section {
      background: white;
      border: 1px solid #dee2e6;
      border-radius: 6px;
      padding: 1rem;
      margin-top: 1rem;
    }
  </style>
</head>
<body>
  <div class="randwater-header">
    <div class="container">
      <div class="row align-items-center">
        <div class="col-md-6">
          <div class="d-flex align-items-center">
            <img src="{{ config.company_logo }}" alt="Rand Water Logo" class="randwater-logo me-3">
            <div>
              <div class="tagline">Create Dummy Payslips and Test Salary Scenarios</div>
            </div>
          </div>
        </div>
        <div class="col-md-6 text-end">
                     <div class="branding">
             <img src="/static/images/smarthr_logo_white.png" alt="SmartHR Logo" class="gosmarthr-logo">
           </div>
        </div>
      </div>
    </div>
  </div>

  <div class="container">
    <!-- Navigation -->
    <div class="mb-4">
      <a href="{{ url_for('randwater_admin_panel') }}" class="btn btn-outline-secondary">
        <i class="fas fa-arrow-left"></i> Back to Dashboard
      </a>
    </div>
    
    <div class="simulator-container">
      <div class="simulator-header">
        <i class="fas fa-calculator"></i> Salary Package Configuration
      </div>
      
      <form id="salaryForm">
        <!-- Basic Information -->
        <div class="form-section">
          <h5><i class="fas fa-info-circle"></i> Basic Information</h5>
          <div class="row">
            <div class="col-md-6">
              <div class="mb-3">
                <label class="form-label">Employee Subgroup</label>
                <select class="form-select" id="employeeSubgroup" required>
                  <option value="">Select Subgroup</option>
                  <option value="other">Other</option>
                  <option value="support_staff">Support Staff</option>
                </select>
              </div>
            </div>
            <div class="col-md-6">
              <div class="mb-3">
                <label class="form-label">Band Range</label>
                <select class="form-select" id="bandRange" required>
                  <option value="">Select Band Range</option>
                  <option value="O_to_Q">O to Q band</option>
                  <option value="non_O_to_Q">Non-O to Q band</option>
                </select>
              </div>
            </div>
          </div>
        </div>

        <!-- Salary Components -->
        <div class="form-section">
          <h5><i class="fas fa-money-bill-wave"></i> Salary Components</h5>
          <div class="row">
            <div class="col-md-6">
              <div class="mb-3">
                <label class="form-label">Total Pensionable Emolument</label>
                <input type="number" class="form-control" id="totalPensionableEmolument" 
                       step="0.01" min="0" placeholder="0.00">
                <div class="warning-badge">
                  <i class="fas fa-info-circle"></i> 
                  Should be 50-70% of TCTC for O-Q band employees
                </div>
              </div>
              
              <div class="mb-3">
                <label class="form-label">Car Allowance</label>
                <input type="number" class="form-control" id="carAllowance" 
                       step="0.01" min="0" placeholder="0.00">
                <div class="warning-badge">
                  <i class="fas fa-info-circle"></i> 
                  Should be at least 30% of TCTC for O-Q band employees
                </div>
              </div>
              
              <div class="mb-3">
                <label class="form-label">Cell Phone Allowance</label>
                <input type="number" class="form-control" id="cellPhoneAllowance" 
                       step="0.01" min="0" placeholder="0.00" readonly>
                <small class="text-muted">Fixed amount - cannot be changed</small>
              </div>
              
              <div class="mb-3">
                <label class="form-label">Data Service Allowance</label>
                <input type="number" class="form-control" id="dataServiceAllowance" 
                       step="0.01" min="0" placeholder="0.00" readonly>
                <small class="text-muted">Fixed amount - cannot be changed</small>
              </div>
            </div>
            
            <div class="col-md-6">
              <div class="mb-3">
                <label class="form-label">Housing Allowance</label>
                <input type="number" class="form-control" id="housingAllowance" 
                       step="0.01" min="0" placeholder="0.00" readonly>
                <small class="text-muted">Fixed amount - cannot be changed</small>
              </div>
              
              <div class="mb-3">
                <label class="form-label">Annual Bonus (13th Cheque)</label>
                <input type="number" class="form-control" id="annualBonus" 
                       step="0.01" min="0" placeholder="0.00">
                <div class="warning-badge">
                  <i class="fas fa-info-circle"></i> 
                  Should be 10-70% of TCTC for O-Q band employees
                </div>
              </div>
              
              <div class="mb-3">
                <label class="form-label">Other Allowances</label>
                <input type="number" class="form-control" id="otherAllowances" 
                       step="0.01" min="0" placeholder="0.00">
              </div>
            </div>
          </div>
        </div>

        <!-- Retirement Fund -->
        <div class="form-section">
          <h5><i class="fas fa-piggy-bank"></i> Retirement Fund</h5>
          <div class="row">
            <div class="col-md-6">
              <div class="mb-3">
                <label class="form-label">Retirement Fund Name</label>
                <select class="form-select" id="retirementFundName">
                  <option value="">Select Fund</option>
                  <option value="RWPROV">RWPROV</option>
                  <option value="RWMPPROV">RWMPPROV</option>
                  <option value="SAMWU">SAMWU</option>
                </select>
              </div>
            </div>
            <div class="col-md-6">
              <div class="mb-3">
                <label class="form-label">Retirement Fund Option</label>
                <select class="form-select" id="retirementFundOption">
                  <option value="">Select Option</option>
                  <option value="option_a">Option A</option>
                  <option value="option_b">Option B</option>
                  <option value="option_c">Option C</option>
                  <option value="option_d">Option D</option>
                  <option value="option_e">Option E</option>
                  <option value="option_f">Option F</option>
                  <option value="option_g">Option G</option>
                  <option value="none">None</option>
                  <option value="samwu">SAMWU</option>
                </select>
              </div>
            </div>
          </div>
        </div>

        <!-- Medical Aid -->
        <div class="form-section">
          <h5><i class="fas fa-heartbeat"></i> Medical Aid</h5>
          <div class="row">
            <div class="col-md-6">
              <div class="mb-3">
                <label class="form-label">Medical Aid Provider</label>
                <select class="form-select" id="medicalAidProvider" onchange="toggleMedicalOptions()">
                  <option value="">Select Provider</option>
                  <option value="randwater">Rand Water</option>
                  <option value="bonitas">Bonita's</option>
                  <option value="none">None</option>
                </select>
              </div>
              
              <div class="mb-3 medical-options" id="randwaterOptions">
                <label class="form-label">Rand Water Option</label>
                <select class="form-select" id="randwaterOption">
                  <option value="">Select Option</option>
                  <option value="option_a">Option A</option>
                  <option value="option_b">Option B</option>
                </select>
              </div>
              
              <div class="mb-3 medical-options" id="bonitasOptions">
                <label class="form-label">Bonita's Option</label>
                <select class="form-select" id="bonitasOption">
                  <option value="">Select Option</option>
                  <option value="standard">Standard</option>
                </select>
              </div>
            </div>
            
            <div class="col-md-6">
              <div class="dependants-section">
                <h6>Dependants</h6>
                <div class="row">
                  <div class="col-md-6">
                    <div class="mb-3">
                      <label class="form-label">Subsidised Adults</label>
                      <input type="number" class="form-control" id="subsidisedAdults" 
                             min="0" value="0">
                    </div>
                    <div class="mb-3">
                      <label class="form-label">Subsidised Children</label>
                      <input type="number" class="form-control" id="subsidisedChildren" 
                             min="0" value="0">
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="mb-3">
                      <label class="form-label">Unsubsidised Adults</label>
                      <input type="number" class="form-control" id="unsubsidisedAdults" 
                             min="0" value="0">
                    </div>
                    <div class="mb-3">
                      <label class="form-label">Unsubsidised Children</label>
                      <input type="number" class="form-control" id="unsubsidisedChildren" 
                             min="0" value="0">
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="text-center">
          <button type="button" class="btn btn-primary me-3" onclick="calculateSalary()">
            <i class="fas fa-calculator"></i> Calculate Salary
          </button>
          <button type="button" class="btn btn-secondary" onclick="resetForm()">
            <i class="fas fa-redo"></i> Reset Form
          </button>
        </div>
      </form>

      <!-- Results -->
      <div id="results" class="result-container" style="display: none;">
        <h5><i class="fas fa-chart-bar"></i> Salary Calculation Results</h5>
        <div id="resultContent"></div>
      </div>
    </div>
  </div>

  <script>
    function toggleMedicalOptions() {
      const provider = document.getElementById('medicalAidProvider').value;
      const randwaterOptions = document.getElementById('randwaterOptions');
      const bonitasOptions = document.getElementById('bonitasOptions');
      
      // Hide all options first
      randwaterOptions.classList.remove('show');
      bonitasOptions.classList.remove('show');
      
      // Show relevant options
      if (provider === 'randwater') {
        randwaterOptions.classList.add('show');
      } else if (provider === 'bonitas') {
        bonitasOptions.classList.add('show');
      }
    }
    
    function calculateSalary() {
      // Collect form data
      const formData = {
        employee_subgroup: document.getElementById('employeeSubgroup').value,
        band_range: document.getElementById('bandRange').value,
        total_pensionable_emolument: parseFloat(document.getElementById('totalPensionableEmolument').value) || 0,
        car_allowance: parseFloat(document.getElementById('carAllowance').value) || 0,
        cell_phone_allowance: parseFloat(document.getElementById('cellPhoneAllowance').value) || 0,
        data_service_allowance: parseFloat(document.getElementById('dataServiceAllowance').value) || 0,
        housing_allowance: parseFloat(document.getElementById('housingAllowance').value) || 0,
        annual_bonus: parseFloat(document.getElementById('annualBonus').value) || 0,
        other_allowances: parseFloat(document.getElementById('otherAllowances').value) || 0,
        retirement_fund_name: document.getElementById('retirementFundName').value,
        retirement_fund_option: document.getElementById('retirementFundOption').value,
        medical_aid_provider: document.getElementById('medicalAidProvider').value,
        medical_aid_option: document.getElementById('medicalAidProvider').value === 'randwater' ? 
                           document.getElementById('randwaterOption').value : 
                           document.getElementById('bonitasOption').value,
        subsidised_adults: parseInt(document.getElementById('subsidisedAdults').value) || 0,
        subsidised_children: parseInt(document.getElementById('subsidisedChildren').value) || 0,
        unsubsidised_adults: parseInt(document.getElementById('unsubsidisedAdults').value) || 0,
        unsubsidised_children: parseInt(document.getElementById('unsubsidisedChildren').value) || 0
      };
      
      // Validate required fields
      if (!formData.employee_subgroup || !formData.band_range) {
        alert('Please fill in all required fields.');
        return;
      }
      
      // Calculate salary
      fetch('/api/salary-simulator/calculate', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(formData)
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          displayResults(data.net_pay, formData);
        } else {
          alert('Error calculating salary: ' + data.error);
        }
      })
      .catch(error => {
        console.error('Error:', error);
        alert('Error calculating salary');
      });
    }
    
    function displayResults(netPay, formData) {
      const resultsDiv = document.getElementById('results');
      const resultContent = document.getElementById('resultContent');
      
      // Calculate totals
      const grossPay = netPay.earnings;
      const totalDeductions = netPay.deductions;
      const takeHome = netPay.take_home;
      
      resultContent.innerHTML = `
        <div class="row">
          <div class="col-md-6">
            <div class="result-item">
              <span class="label">Gross Pay:</span>
              <span class="value">R ${grossPay.toFixed(2)}</span>
            </div>
            <div class="result-item">
              <span class="label">Tax:</span>
              <span class="value">R ${netPay.monthly_tax.toFixed(2)}</span>
            </div>
            <div class="result-item">
              <span class="label">UIF:</span>
              <span class="value">R ${netPay.uif.toFixed(2)}</span>
            </div>
            <div class="result-item">
              <span class="label">Other Deductions:</span>
              <span class="value">R ${(totalDeductions - netPay.monthly_tax - netPay.uif).toFixed(2)}</span>
            </div>
          </div>
          <div class="col-md-6">
            <div class="result-item">
              <span class="label">Total Deductions:</span>
              <span class="value">R ${totalDeductions.toFixed(2)}</span>
            </div>
            <div class="result-item">
              <span class="label">Employer Contributions:</span>
              <span class="value">R ${netPay.employer.toFixed(2)}</span>
            </div>
            <div class="result-item">
              <span class="label">Rand Water Benefits:</span>
              <span class="value">R ${netPay.randwater_benefits.toFixed(2)}</span>
            </div>
          </div>
        </div>
        <div class="result-item total">
          <span class="label">Take Home Pay:</span>
          <span class="value">R ${takeHome.toFixed(2)}</span>
        </div>
      `;
      
      resultsDiv.style.display = 'block';
    }
    
    function resetForm() {
      document.getElementById('salaryForm').reset();
      document.getElementById('results').style.display = 'none';
      toggleMedicalOptions();
    }
    
    // Initialize form
    document.addEventListener('DOMContentLoaded', function() {
      toggleMedicalOptions();
    });
  </script>
</body>
</html>
